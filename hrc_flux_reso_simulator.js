//JavaScript code for flux/resolution simulator for HRC
// programed by T. Nakajima (ISSP-NSL) 2020

var version = "0.2";
var Ei_numMax=5;
var Ei1 = new Array(Ei_numMax);
var Ei2 = new Array(Ei_numMax);
var decimal_digit = 1000;
var TOFconst = 2.286;       // TOF at 1 m is 2.286/sqrt(E)
var TOF_len_R = 40;       // Real TOF max (ms)
var Lsc_R = 15.0-1.03;

function draw(){

    document.getElementById("verNum").innerHTML=version;
    document.getElementById("verNum2").innerHTML=version;

    var trace1_cal;
    var trace1_cal_x;
    var trace1_cal_y;
    var trace1_obs;
    var trace1_obs_x;
    var trace1_obs_y;
    var trace1_cal_name;
    var trace1_obs_name;
    var trace1_color;
    var trace1_color2;
    var trace1_Ymax;

    var trace2_cal;
    var trace2_cal_x;
    var trace2_cal_y;
    var trace2_obs;
    var trace2_obs_x;
    var trace2_obs_y;
    var trace2_cal_name;
    var trace2_obs_name;
    var trace2_color;
    var trace2_color2;
    var trace2_Ymax;

    var trace1_Ei_name;
    var trace2_Ei_name;

    var trace3_cal;
    var trace3_cal_x;
    var trace3_cal_y;
    var trace3_obs;
    var trace3_obs_x;
    var trace3_obs_y;
    var trace3_cal_name;
    var trace3_obs_name;
    var trace3_color;
    var trace3_color2;
    var trace3_Ymax;

    var trace4_cal;
    var trace4_cal_x;
    var trace4_cal_y;
    var trace4_obs;
    var trace4_obs_x;
    var trace4_obs_y;
    var trace4_cal_name;
    var trace4_obs_name;
    var trace4_color;
    var trace4_color2;
    var trace4_Ymax;

    var Ymax_Reso=0.1;

    var TargetEi1 = Number(document.getElementById('targetEi1').value);
    var TargetTOF_at_Chopper1=(TOFconst*(Lsc_R)/Math.sqrt(TargetEi1));
    var upperLimitEi1 = Number(document.getElementById('upperLimitEi1').value);

    var TargetEi2 = Number(document.getElementById('targetEi2').value);
    var TargetTOF_at_Chopper2=(TOFconst*(Lsc_R)/Math.sqrt(TargetEi2));
    var upperLimitEi2 = Number(document.getElementById('upperLimitEi2').value);

    var ChopOfst_R1 =0;      //Real chopper offset (ms)
    var ChopOfst_R2 =0;      //Real chopper offset (ms)

    var TOF_at_Chopper1 = new Array(50);
    var TOF_at_Chopper2 = new Array(50);

    var freq1=200;
    var freq2=200;


    //data for FermiA 100Hz
    var FermiA_IntCalc_100Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_100Hz_y= [5.079740154,22.92330456,68.43294832,183.4019796,438.0957323,851.0278758,1473.019266,2349.944891,3514.487252,4434.372455,6157.01846,6924.680078,6624.013721,5576.532979,4798.296879,4011.793812,3514.152615,3203.459363,3060.119452,3143.796286,3326.404587,3520.163658,3788.70926,3620.312252,3450.682266,3252.914323,3346.374115,3453.188423,3441.729593,3709.626791,3849.214116,3853.669753,3966.022545,4006.580921,4103.417265,4183.485738,4317.181318];
    var FermiA_IntObs_100Hz_x=[1.437,1.483,1.581,2.387,2.577,2.926,3.131,3.481,3.656,8.847,10.28,11.47,13.37,15.49,19.76,22.23,25.22,28.87,33.36];
    var FermiA_IntObs_100Hz_y=[14.6827408,18.9475286,34.9121318,327.427828,469.098448,746.77512,931.55062,1208.7985,915.47092,5717.6028,6102.3872,7510.0662,8327.0278,6945.302,5931.9988,5540.89536,4673.88922,4256.21196,3750.06814];
    var FermiA_IntMax_100Hz=9000;
    var FermiA_Color_100Hz='#6600CC';
    var FermiA_Color2_100Hz='#6600CC';
    var FermiA_Name_100Hz='Fermi A 100 Hz';
    var FermiA_ResoCalc_100Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_100Hz_y= [0.017041892,0.018519143,0.020273584,0.022275375,0.024548177,0.027070055,0.029983499,0.033190816,0.036949669,0.041116082,0.045857329,0.05119466,0.057185734,0.063931436,0.07152514,0.080093994,0.089744755,0.100612492,0.11283058,0.126537551,0.141929344,0.159199419,0.178588637,0.200340395,0.224748913,0.252133453,0.282872017,0.317360457,0.356064353,0.399490233,0.448213164,0.50287971,0.564233655,0.633071581,0.710297945,0.796957523,0.894177472];
    var FermiA_ResoObs_100Hz_x= [1.437,1.483,1.581,2.387,2.577,2.926,3.131,3.481,3.656,8.847,10.28,11.47,13.37,15.49,19.76,22.23,25.22,28.87,33.36];
    var FermiA_ResoObs_100Hz_y= [0.016527,0.016015,0.018027,0.021889,0.023962,0.025974,0.027308,0.028656,0.028583,0.044026,0.046206,0.049695,0.053291,0.055197,0.0625,0.066239,0.069687,0.074039,0.079736];

    //data for FermiA 200Hz
    var FermiA_IntCalc_200Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_200Hz_y= [0,0,0,0,0,5.964262988,84.03235359,305.5394511,747.3798072,1308.589374,2296.216002,3045.583218,3245.351103,2933.135621,2647.773662,2288.948105,2051.604167,1899.362343,1831.615452,1889.340478,1998.963515,2107.793285,2254.460058,2136.131649,2015.931701,1879.985734,1913.102865,1952.954842,1926.301773,2055.782522,2113.342254,2097.42913,2141.29208,2147.211634,2184.182474,2213.019029,2270.845656];
    var FermiA_IntObs_200Hz_x=[5.5375,5.9606,6.9069,7.4,7.9494,8.2671,8.5665,11.473,13.774,15.491,19.754,22.228,25.207,27.045,28.856,51.225,77.068,102.99,207.38,312.61,525.25,740.79,1067.7];
    var FermiA_IntObs_200Hz_y=[66.952,127.85,327.32,466.26,642.78,750.21,862.83,1995.8,2562.4,2675.6,2605.4,2629.6,2336.9,2270.3,2244.7,1879.6,1831.2,1865.3,1879.8,1829.7,2139,2518.6,2870.8];
    var FermiA_IntMax_200Hz=4000;
    var FermiA_Color_200Hz='#0000EE';
    var FermiA_Color2_200Hz='#0000EE';
    var FermiA_Name_200Hz='Fermi A 200 Hz';
    var FermiA_ResoCalc_200Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_200Hz_y= [0.011824169,0.012383352,0.013126536,0.013988102,0.014975951,0.016015397,0.017303338,0.018621759,0.020370258,0.022229244,0.024428336,0.026921752,0.029716754,0.032893392,0.03650352,0.040646018,0.045365997,0.050737266,0.056810509,0.0636225,0.071291151,0.079895742,0.089569383,0.100417833,0.112599677,0.12626079,0.141619577,0.158844661,0.178181835,0.199882847,0.224231876,0.251548703,0.282218619,0.316629595,0.355231338,0.398555367,0.447156146];
    var FermiA_ResoObs_200Hz_x= [5.5375,5.9606,6.9069,7.4,7.9494,8.2671,8.5665,11.473,13.774,15.491,19.754,22.228,25.207,27.045,28.856,51.225,77.068,102.99,207.38,312.61,525.25,740.79,1067.7];
    var FermiA_ResoObs_200Hz_y= [0.018125,0.018206,0.019288,0.019904,0.020636,0.021119,0.021482,0.025758,0.028807,0.030577,0.034264,0.035966,0.037747,0.038795,0.039575,0.049666,0.059738,0.069529,0.10865,0.13621,0.16902,0.19746,0.23596];

    //data for FermiA 300Hz
    var FermiA_IntCalc_300Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_300Hz_y= [0,0,0,0,0,0,0,0,0,70.37072924,357.787694,790.5840461,1162.706431,1318.787081,1402.138767,1357.714275,1310.663337,1276.819994,1276.172965,1349.361154,1452.591581,1549.393038,1669.449691,1588.044776,1500.7867,1398.164211,1418.865876,1441.814588,1414.007899,1499.522508,1531.396254,1509.874034,1531.676404,1526.577932,1543.918543,1555.906608,1588.57926];
    var FermiA_IntObs_300Hz_x=[6.49732,6.89212,7.16825,7.21521,7.58765,7.7007,8.14513,9.4245,10.9534,12.001,13.0094,13.7339,13.8586,14.865,15.1768,16.4266,20.2737,25.3768,29.2131,33.182,36.211,36.7484,41.2491,42.7059,48.8675,71.3521,111.308,151.349,204.871,256.394,266.683,370.03,411.28,646.044];
    var FermiA_IntObs_300Hz_y=[1.247218571,4.091071517,6.894611953,7.619123785,12.83535051,15.05536968,22.6001149,55.96392751,100.7321137,146.1621196,207.1767898,231.4999351,242.1560145,300.9541414,323.3216607,401.5253899,578.7312425,714.5790189,796.9641208,841.3424488,878.7629749,887.2979441,941.0876256,966.0360549,994.341139,1157.487193,1343.159268,1419.959071,1347.543972,1315.29447,1351.588537,1505.669105,1565.646347,1860.752762];
    var FermiA_IntMax_300Hz=2000;
    var FermiA_Color_300Hz='#00CCCC';
    var FermiA_Color2_300Hz='#00CCCC';
    var FermiA_Name_300Hz='Fermi A 300 Hz';
    var FermiA_ResoCalc_300Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_300Hz_y= [0.010579191,0.010873556,0.011318126,0.011832758,0.012418425,0.01297267,0.013724707,0.014386833,0.01545834,0.01651015,0.017827696,0.019329997,0.021000613,0.022922628,0.025137396,0.027750156,0.030784648,0.034298406,0.038308779,0.042805141,0.04788799,0.053591138,0.060017305,0.067219471,0.075316031,0.084389045,0.094616665,0.106078891,0.11895399,0.133408124,0.149627029,0.167820008,0.188258793,0.211190583,0.23691238,0.265788674,0.298178981];
    var FermiA_ResoObs_300Hz_x = [6.49732,6.89212,7.16825,7.21521,7.58765,7.7007,8.14513,9.4245,10.9534,12.001,13.0094,13.7339,13.8586,14.865,15.1768,16.4266,20.2737,25.3768,29.2131,33.182,36.211,36.7484,41.2491,42.7059,48.8675,71.3521,111.308,151.349,204.871,256.394,266.683,370.03,411.28,646.044];
    var FermiA_ResoObs_300Hz_y = [0.016092912,0.016068532,0.016319538,0.016170597,0.016322962,0.016428078,0.016957375,0.01768767,0.019365485,0.019946675,0.020335429,0.020378319,0.020406601,0.020601579,0.020730047,0.020908721,0.022207082,0.024962357,0.026979446,0.029001884,0.030638687,0.030935027,0.033107704,0.033850253,0.036126828,0.043507521,0.052668294,0.060249291,0.071191921,0.083759614,0.087594372,0.106418973,0.110740554,0.134405551];
    
    //data for FermiA 400Hz
    var FermiA_IntCalc_400Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_400Hz_y= [0,0,0,0,0,0,0,0,0,0,0,19.38742346,178.3105198,370.9208169,545.5148456,656.2706148,745.343056,818.2269439,885.2757871,985.5432492,1099.179692,1201.480704,1317.13486,1267.716495,1207.566636,1130.350914,1150.329755,1169.965897,1146.711883,1213.552756,1235.177018,1212.680457,1224.606818,1214.796348,1222.822649,1226.736147,1247.050767];
    var FermiA_IntObs_400Hz_x=[15.85,25.15,28.78,33.25,67.59,84.76,109.3,519.8];
    var FermiA_IntObs_400Hz_y=[8.592766,121.675372,190.733452,263.408054,589.92752,669.87466,775.38006,1034.85564];
    var FermiA_IntMax_400Hz=1500;
    var FermiA_Color_400Hz='#339900';
    var FermiA_Color2_400Hz='#339900';
    var FermiA_Name_400Hz='Fermi A 400 Hz';
    var FermiA_ResoCalc_400Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_400Hz_y= [0.010107285,0.010292939,0.010612629,0.010978874,0.011388399,0.011722594,0.012227195,0.012571986,0.013317837,0.01396571,0.014839334,0.015835169,0.016920544,0.018184112,0.019663985,0.021479327,0.023644489,0.026212962,0.029182315,0.032509079,0.036291191,0.040534532,0.045330649,0.050701163,0.056748045,0.063517039,0.071175742,0.079750348,0.089389607,0.100216411,0.112366176,0.125991813,0.141312709,0.158502269,0.177780303,0.199430822,0.223712841];
    var FermiA_ResoObs_400Hz_x = [15.85,25.15,28.78,33.25,67.59,84.76,109.3,519.8];
    var FermiA_ResoObs_400Hz_y = [0.014984,0.016998,0.018155,0.02,0.030922,0.034185,0.039113,0.093209];

    //data for FermiA 500Hz
    var FermiA_IntCalc_500Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_500Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,0,16.68341574,114.6191134,230.534179,343.6586546,451.1800245,559.4097922,688.8268415,820.7626041,936.4025433,1057.049165,1038.062158,1002.879448,947.7623955,971.0917038,991.7885299,974.3844884,1032.172886,1050.331848,1029.706109,1037.294263,1025.731697,1028.840493,1028.369262,1041.559833];
    var FermiA_IntObs_500Hz_x=[18.828,20.005,21.149,26.55,30.464,35.324,38.403,38.608,41.502,57.532,70.683,88.978,101.77,102.65,115.64,206.44,310.96,521.48,734.19,751.51,1056.5];
    var FermiA_IntObs_500Hz_y=[4.3448,7.9747,12.36,32.068,48.662,83.58,113.29,116.26,141.61,283.57,375.31,482.63,546.71,555.19,608.83,752.25,763.62,1001.4,1179.5,1211,1300.4];
    var FermiA_IntMax_500Hz=1500;
    var FermiA_Color_500Hz='#999900';
    var FermiA_Color2_500Hz='#999900';
    var FermiA_Name_500Hz='Fermi A 500 Hz';
    var FermiA_ResoCalc_500Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_500Hz_y= [0.009881232,0.010012805,0.010269689,0.010560299,0.010878677,0.011096412,0.01146805,0.011636538,0.012200609,0.012615438,0.013229562,0.013923692,0.014652342,0.015508202,0.01652792,0.017845813,0.019472556,0.021463021,0.023801436,0.02641822,0.029414371,0.032775212,0.036588672,0.040853788,0.045665512,0.051044388,0.057159182,0.063996382,0.071690376,0.080337726,0.090042792,0.10092373,0.113172053,0.126914181,0.142322943,0.159636479,0.179051091];
    var FermiA_ResoObs_500Hz_x=[18.828,20.005,21.149,26.55,30.464,35.324,38.403,38.608,41.502,57.532,70.683,88.978,101.77,102.65,115.64,206.44,310.96,521.48,734.19,751.51,1056.5];
    var FermiA_ResoObs_500Hz_y=[0.015058,0.015223,0.015462,0.017433,0.018784,0.018938,0.019299,0.019207,0.019535,0.022586,0.025454,0.029039,0.031153,0.031228,0.033351,0.044182,0.05782,0.081293,0.093687,0.094384,0.10926];

    //data for FermiA 600Hz
    var FermiA_IntCalc_600Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_IntCalc_600Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33.11127139,111.2975703,205.6318088,310.216523,436.7916901,578.0583531,710.9273382,841.8675503,853.0685243,842.0914617,807.6096403,836.4090281,860.4053616,849.4143698,902.5286768,919.8702049,902.1897518,908.5148544,897.160833,897.8528485,895.0348306,903.8384855];
    var FermiA_IntObs_600Hz_x=[28.77,33.278,38.84,45.938,67.757,84.813,109.26,146.1,205.5,310.82,519.1,1050,3174.2];
    var FermiA_IntObs_600Hz_y=[5.8239,18.944,31.087,44.379,157.49,239.54,325.74,424.62,449.62,592.52,697.67,809.95,694.2];
    var FermiA_IntMax_600Hz=1500;
    var FermiA_Color_600Hz='#FF0000';
    var FermiA_Color2_600Hz='#FF0000';
    var FermiA_Name_600Hz='Fermi A 600 Hz';
    var FermiA_ResoCalc_600Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiA_ResoCalc_600Hz_y= [0.009756243,0.009857297,0.010078512,0.010325815,0.010591515,0.010740974,0.011033804,0.011095386,0.011548506,0.011817466,0.012266891,0.012765955,0.013258578,0.01383943,0.014543649,0.015519491,0.01677698,0.018375173,0.020288905,0.022426649,0.024894947,0.027662582,0.030817501,0.034340748,0.038324861,0.042770845,0.047854346,0.053529376,0.059923478,0.06711537,0.075188004,0.084235611,0.094434039,0.105876152,0.118702904,0.133123861,0.149291517];
    var FermiA_ResoObs_600Hz_x=[28.77,33.278,38.84,45.938,67.757,84.813,109.26,146.1,205.5,310.82,519.1,1050,3174.2];
    var FermiA_ResoObs_600Hz_y=[0.014859,0.016599,0.018436,0.01987,0.020923,0.023435,0.02704,0.032512,0.036983,0.049947,0.069543,0.090476,0.1595];

    //data for FermiB 100Hz
    var FermiB_IntCalc_100Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_100Hz_y= [0,0,0,6.590490912,62.35229181,214.6477471,514.5014936,981.0333467,1583.258955,2016.49508,2727.968149,2907.786223,2573.505945,1963.454554,1514.05944,1131.458893,886.2493024,723.9952494,621.4487718,575.1155935,549.876629,527.4858729,516.4861344,450.6463551,393.8011733,341.7474674,325.0957893,311.553079,289.663135,292.5332373,285.6520195,270.2752203,263.9775464,254.0975482,248.9123959,243.612475,242.1664681];
    var FermiB_IntObs_100Hz_x=[2.1692,2.254,2.562,3.1094,3.5238,3.8593,4.9127,5.9521,6.8964,7.3882,7.9359,10.165,15.257,20.351,25.454,51.027,102.39,205.68,309.47,517.98];
    var FermiB_IntObs_100Hz_y=[8.7258,17.602,78.853,292.3,500.73,177.87,731.82,1537.9,2027.6,2296.8,2532.5,2900.9,2686.7,1687.9,1108.5,389.09,183.16,89.035,58.834,48.9];
    var FermiB_IntMax_100Hz=3000;
    var FermiB_Color_100Hz='#6600CC';
    var FermiB_Color2_100Hz='#6600CC';
    var FermiB_Name_100Hz='Fermi B 100 Hz';
    var FermiB_ResoCalc_100Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_100Hz_y= [0.01182416917,0.01238335207,0.01312653639,0.01398810208,0.01497595086,0.01601539694,0.01730333759,0.01862175896,0.02037025849,0.02222924418,0.02442833602,0.02692175181,0.02971675436,0.03289339202,0.03650351989,0.04064601801,0.04536599691,0.05073726635,0.05681050924,0.06362250042,0.07129115085,0.07989574219,0.08956938342,0.1004178326,0.1125996773,0.1262607899,0.1416195771,0.158844661,0.1781818346,0.1998828467,0.2242318756,0.2515487032,0.2822186188,0.3166295953,0.3552313376,0.3985553674,0.4471561455];
    var FermiB_ResoObs_100Hz_x=[2.1692,2.254,2.562,3.1094,3.5238,3.8593,4.9127,5.9521,6.8964,7.3882,7.9359,10.165,15.257,20.351,25.454,51.027,102.39,205.68,309.47,517.98];
    var FermiB_ResoObs_100Hz_y=[0.018013,0.019027,0.019415,0.021118,0.022145,0.019162,0.025499,0.027604,0.02887,0.029584,0.030241,0.033474,0.039425,0.042548,0.044792,0.052077,0.057297,0.066791,0.08079,0.10055];

    //data for FermiB 200Hz
    var FermiB_IntCalc_200Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_200Hz_y= [0,0,0,0,0,0,0,0,0,44.64578954,319.8535045,756.6824084,1112.169623,1203.004944,1164.185223,1017.256556,889.8501878,784.4379657,704.5459977,661.9652425,630.5091784,595.6356156,570.4913283,484.420176,410.6649277,344.8224185,317.0737621,293.3413302,263.1688099,256.4376425,241.6563359,220.7618841,208.3776571,194.0378923,184.0957185,174.7534639,168.7315203];
    var FermiB_IntObs_200Hz_x=[8.2521,8.5508,11.451,13.745,15.456,19.704,22.168,25.134,26.96,28.763,51.03,76.689,102.41,205.79,309.71,518.8,729.18,1047.7];
    var FermiB_IntObs_200Hz_y=[17.012,32.829,469.56,854.88,1041.7,1175.3,1209.7,1100.4,1056.8,1050.4,710.88,513.18,407.7,208.27,137.21,115.48,106.58,100.16];
    var FermiB_IntMax_200Hz=1500;
    var FermiB_Color_200Hz='#0000EE';
    var FermiB_Color2_200Hz='#0000EE';
    var FermiB_Name_200Hz='Fermi B 200 Hz';
    var FermiB_ResoCalc_200Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_200Hz_y= [0.01010728451,0.0102929391,0.01061262882,0.01097887372,0.01138839924,0.01172259404,0.01222719546,0.01257198563,0.01331783717,0.01396571025,0.01483933408,0.01583516935,0.01692054427,0.01818411185,0.01966398471,0.02147932724,0.02364448865,0.0262129616,0.02918231521,0.03250907909,0.03629119097,0.04053453215,0.04533064895,0.05070116323,0.05674804513,0.0635170391,0.0711757424,0.07975034751,0.08938960679,0.1002164109,0.1123661761,0.1259918125,0.1413127087,0.1585022685,0.1777803033,0.1994308221,0.2237128411];
    var FermiB_ResoObs_200Hz_x=[8.2521,8.5508,8.5513,9.0307,9.2559,11.451,13.745,15.456,19.704,22.168,25.134,26.96,28.763,28.765,31.83,33.347,51.03,76.689,102.41,205.79,309.71,518.8,729.18,1047.7,1047.8,2126.6,3224.5];
    var FermiB_ResoObs_200Hz_y=[0.018814,0.017961,0.01827,0.018144,0.0186,0.019786,0.021357,0.022408,0.024154,0.025054,0.025839,0.026328,0.02697,0.026844,0.027742,0.028348,0.033601,0.037386,0.039398,0.046609,0.05612,0.076181,0.086749,0.099071,0.099138,0.14632,0.21372];

    //data for FermiB 300Hz
    var FermiB_IntCalc_300Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_300Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,2.267225986,104.8489736,261.3661183,388.1219296,482.8443617,536.9941096,563.0483702,594.0472931,618.5083002,621.5248675,616.956506,530.5168711,449.8400401,374.8531779,340.8194788,310.6370132,273.9808694,262.0620506,242.1260837,216.6706065,200.288356,182.6027249,169.6104662,157.6727222,149.1377645];
    var FermiB_IntObs_300Hz_x=[15.829,16.734,21.056,24.375,33.243,38.796,45.893,50.493,76.673,102.4,205.81,309.79,519.07,729.98];
    var FermiB_IntObs_300Hz_y=[8.9511,12.974,86.039,180.01,355.31,425.79,469.81,501.69,520.03,499.93,296.53,196.21,162.09,151.97];
    var FermiB_IntMax_300Hz=800;
    var FermiB_Color_300Hz='#00CCCC';
    var FermiB_Color2_300Hz='#00CCCC';
    var FermiB_Name_300Hz='Fermi B 300 Hz';
    var FermiB_ResoCalc_300Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_300Hz_y= [0.00975624306,0.00985729662,0.01007851162,0.01032581516,0.01059151455,0.01074097391,0.01103380398,0.01109538575,0.01154850644,0.01181746593,0.01226689122,0.01276595476,0.01325857757,0.0138394302,0.014543649,0.0155194908,0.01677698006,0.01837517287,0.0202889049,0.02242664944,0.02489494697,0.02766258162,0.0308175006,0.03434074837,0.03832486061,0.04277084541,0.0478543464,0.05352937649,0.05992347797,0.06711536965,0.07518800418,0.0842356105,0.09443403907,0.1058761521,0.1187029039,0.1331238612,0.1492915166];
    var FermiB_ResoObs_300Hz_x=[15.829,16.734,21.056,24.375,33.243,38.796,45.893,50.493,55.204,76.673,102.4,205.81,309.79,519.07,729.98,1049.1];
    var FermiB_ResoObs_300Hz_y=[0.018306,0.018289,0.018401,0.018657,0.020633,0.022012,0.023188,0.023918,0.024626,0.027238,0.03044,0.038698,0.046329,0.064598,0.073634,0.081888];

    //data for FermiB 400Hz
    var FermiB_IntCalc_400Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_400Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20.1109053,96.43111718,191.6947445,291.4069282,394.2400444,478.6115342,533.3814824,574.0070701,526.49131,466.8827156,397.6227891,364.4039194,331.8732196,291.126939,276.1090976,252.3854299,223.0628726,203.4912365,182.9318367,167.4354222,153.3496217,142.8713352];
    var FermiB_IntObs_400Hz_x=[22.155,25.119,26.948,28.748,28.749,31.812,32.043,33.335,45.958,55.181,67.529,75.874,84.681,84.685,101.09,102.4,109.93,205.84,309.82,518.96,729.96,1048.7,1048.9,2128.8,2264.1,3230.2];
    var FermiB_IntObs_400Hz_y=[2.0074,6.225,9.2598,11.491,12.982,17.877,19.712,24.457,128.16,207.81,294.35,327.85,351.18,360.97,393.95,403.78,411.77,354,256.83,226.28,207.53,185.55,184,177.43,94.805,181.61];
    var FermiB_IntMax_400Hz=800;
    var FermiB_Color_400Hz='#339900';
    var FermiB_Color2_400Hz='#339900';
    var FermiB_Name_400Hz='Fermi B 400 Hz';
    var FermiB_ResoCalc_400Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_400Hz_y= [0.00963035597,0.00970020062,0.00988475461,0.01008726104,0.01029804693,0.01037548934,0.01058437589,0.01052976978,0.0108613593,0.01096660861,0.01122815188,0.01149980675,0.01170938301,0.01195130097,0.01225616691,0.0127936382,0.01357604087,0.01467418297,0.01605150807,0.01758108754,0.01938314035,0.02140041976,0.02372585207,0.02631206311,0.02925327249,0.03252031754,0.03631055943,0.04052457063,0.04528725765,0.05065444878,0.05668080294,0.06342896432,0.07106169761,0.07962497247,0.08921866114,0.1000211017,0.1121255524];
    var FermiB_ResoObs_400Hz_x=[22.155,25.119,26.948,28.748,28.749,31.812,32.043,33.335,45.958,55.181,67.529,75.874,84.681,84.685,101.09,102.4,109.93,205.84,309.82,518.96,729.96,1048.7,1048.9,2128.8,2264.1,3230.2];
    var FermiB_ResoObs_400Hz_y=[0.016956,0.01724,0.017328,0.018047,0.018179,0.018964,0.019,0.019185,0.01898,0.020153,0.021481,0.022479,0.023283,0.023141,0.024526,0.024591,0.025173,0.033321,0.0409,0.060515,0.06877,0.075671,0.077479,0.10227,0.096498,0.13359];

    //data for FermiB 500Hz
    var FermiB_IntCalc_500Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_500Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15.93254584,76.13366469,166.1366913,275.2835708,378.8629003,463.0624759,461.8728624,436.6139061,391.9291182,373.7816096,347.2079762,306.7390325,291.0218936,265.0209985,232.6981812,210.6034382,187.5768722,169.9229701,153.9555966,141.8151527];
    var FermiB_IntObs_500Hz_x=[35.257,38.33,38.524,41.413,57.41,70.534,88.777,101.52,102.38,115.35,205.73,309.74,518.96,729.77,746.53,1048.7];
    var FermiB_IntObs_500Hz_y=[4.8047,7.7088,8.1191,10.984,41.642,97.926,176.04,225.28,222.68,268.19,323.84,270.41,255.24,242.78,236.98,215.25];
    var FermiB_IntMax_500Hz=600;
    var FermiB_Color_500Hz='#999900';
    var FermiB_Color2_500Hz='#999900';
    var FermiB_Name_500Hz='Fermi B 500 Hz';
    var FermiB_ResoCalc_500Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_500Hz_y= [0.00957152771,0.00962661974,0.00979377515,0.0099749133,0.01015934381,0.01020189037,0.01036976265,0.01025741678,0.01052813595,0.01054957618,0.0107133217,0.01086391786,0.01091816057,0.01096787105,0.01103805179,0.01131172224,0.01180417429,0.01259829832,0.01365196389,0.01481098136,0.01620940469,0.01776990507,0.01959290318,0.02160857863,0.02391659571,0.02646412419,0.0294746192,0.03280389569,0.03658124894,0.04084823717,0.04564099175,0.05100146191,0.05709135533,0.06392336267,0.07157140132,0.08019980636,0.08986158246];
    var FermiB_ResoObs_500Hz_x=[35.257,38.33,38.524,41.413,57.41,70.534,88.777,101.52,102.38,115.35,205.73,309.74,518.96,729.77,746.53,1048.7];
    var FermiB_ResoObs_500Hz_y=[0.015647,0.017234,0.017061,0.018341,0.019499,0.019328,0.020314,0.021403,0.02155,0.022603,0.028188,0.035464,0.054522,0.06454,0.064864,0.072707];

    //data for FermiB 600Hz
    var FermiB_IntCalc_600Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_IntCalc_600Hz_y= [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.420987612,32.56739434,104.8412188,201.3913703,311.2749093,361.240771,373.9390128,357.0851109,358.0343601,346.7562393,315.1846439,302.8484212,276.8618273,242.8183764,218.9835478,193.9600841,174.4720356,156.8526679,143.2473635];
    var FermiB_IntObs_600Hz_x=[345.864,50.459,55.159,55.168,63.557,67.593,67.9,84.628,109.06,126.61,146.08,146.1,184.98,205.69,207.32,309.72,519.08,729.94,1048.8,1049.2,2130,3138.2,3230.4];
    var FermiB_IntObs_600Hz_y=[3.8083,6.518,9.4376,9.8478,15.56,18.628,18.144,45.076,113.19,163.26,208.41,204.71,244.62,253.52,249.08,252.82,277.09,274.4,249.16,256.2,229,84.434,215.68];
    var FermiB_IntMax_600Hz=600;
    var FermiB_Color_600Hz='#FF0000';
    var FermiB_Color2_600Hz='#FF0000';
    var FermiB_Name_600Hz='Fermi B 600 Hz';
    var FermiB_ResoCalc_600Hz_x= [0.99999,1.2589,1.5849,1.9953,2.5119,3.1623,3.981,5.0118,6.3096,7.9433,9.9999,12.589,15.849,19.953,25.119,31.623,39.81,50.118,63.096,79.433,99.999,125.89,158.49,199.53,251.19,316.23,398.1,501.18,630.96,794.33,999.99,1258.9,1584.9,1995.3,2511.9,3162.3,3981];
    var FermiB_ResoCalc_600Hz_y= [0.00953941956,0.00958641316,0.00974399816,0.00991335125,0.01008319921,0.01010633991,0.01025129959,0.0101063961,0.01034262681,0.01031597616,0.01042300776,0.01050237156,0.01046331284,0.01039473766,0.0103162486,0.01041875484,0.01071961705,0.01131209756,0.01215149976,0.0130622829,0.01419095101,0.01544410882,0.01693011248,0.01856056105,0.02044180838,0.02250119538,0.02498939309,0.02772291254,0.03083854824,0.03436799581,0.03833383662,0.04276282062,0.04782145323,0.05349611066,0.05984233689,0.06701901362,0.07504845039];
    var FermiB_ResoObs_600Hz_x=[45.864,50.459,55.159,55.168,63.557,67.593,67.9,84.628,109.06,126.61,146.08,146.1,184.98,205.69,207.32,309.72,519.08,729.94,1048.8,1049.2,2130,3138.2,3230.4];
    var FermiB_ResoObs_600Hz_y=[0.015052,0.016526,0.017121,0.017861,0.018761,0.019526,0.018967,0.019907,0.020181,0.021121,0.02238,0.022254,0.024371,0.025431,0.025519,0.03118,0.049714,0.059934,0.06743,0.067361,0.087009,0.097728,0.10818];
    
    switch(document.getElementById('ChopperSetiing1').value){
      case 'FermiA_100Hz':
        trace1_cal_x = FermiA_IntCalc_100Hz_x;
        trace1_cal_y = FermiA_IntCalc_100Hz_y;
        trace1_obs_x = FermiA_IntObs_100Hz_x;
        trace1_obs_y = FermiA_IntObs_100Hz_y;
        trace1_color = FermiA_Color_100Hz;
        trace1_color2 = FermiA_Color2_100Hz;
        trace1_cal_name = FermiA_Name_100Hz+" (calc)";
        trace1_obs_name = FermiA_Name_100Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_100Hz;
        freq1=100;
        trace1_Ei_name="Ei for "+FermiA_Name_100Hz;
        trace3_cal_x = FermiA_ResoCalc_100Hz_x;
        trace3_cal_y = FermiA_ResoCalc_100Hz_y;
        trace3_obs_x = FermiA_ResoObs_100Hz_x;
        trace3_obs_y = FermiA_ResoObs_100Hz_y;
        break;
      case 'FermiA_200Hz':
        trace1_cal_x = FermiA_IntCalc_200Hz_x;
        trace1_cal_y = FermiA_IntCalc_200Hz_y;
        trace1_obs_x = FermiA_IntObs_200Hz_x;
        trace1_obs_y = FermiA_IntObs_200Hz_y;
        trace1_color = FermiA_Color_200Hz;
        trace1_color2 = FermiA_Color2_200Hz;
        trace1_cal_name = FermiA_Name_200Hz+" (calc)";
        trace1_obs_name = FermiA_Name_200Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_200Hz;
        freq1=200;
        trace1_Ei_name="Ei for "+FermiA_Name_200Hz;
        trace3_cal_x = FermiA_ResoCalc_200Hz_x;
        trace3_cal_y = FermiA_ResoCalc_200Hz_y;
        trace3_obs_x = FermiA_ResoObs_200Hz_x;
        trace3_obs_y = FermiA_ResoObs_200Hz_y;
        break;
      case 'FermiA_300Hz':
        trace1_cal_x = FermiA_IntCalc_300Hz_x;
        trace1_cal_y = FermiA_IntCalc_300Hz_y;
        trace1_obs_x = FermiA_IntObs_300Hz_x;
        trace1_obs_y = FermiA_IntObs_300Hz_y;
        trace1_color = FermiA_Color_300Hz;
        trace1_color2 = FermiA_Color2_300Hz;
        trace1_cal_name = FermiA_Name_300Hz+" (calc)";
        trace1_obs_name = FermiA_Name_300Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_300Hz;
        freq1=300;
        trace1_Ei_name="Ei for "+FermiA_Name_300Hz;
        trace3_cal_x = FermiA_ResoCalc_300Hz_x;
        trace3_cal_y = FermiA_ResoCalc_300Hz_y;
        trace3_obs_x = FermiA_ResoObs_300Hz_x;
        trace3_obs_y = FermiA_ResoObs_300Hz_y;
        break;
      case 'FermiA_400Hz':
        trace1_cal_x = FermiA_IntCalc_400Hz_x;
        trace1_cal_y = FermiA_IntCalc_400Hz_y;
        trace1_obs_x = FermiA_IntObs_400Hz_x;
        trace1_obs_y = FermiA_IntObs_400Hz_y;
        trace1_color = FermiA_Color_400Hz;
        trace1_color2 = FermiA_Color2_400Hz;
        trace1_cal_name = FermiA_Name_400Hz+" (calc)";
        trace1_obs_name = FermiA_Name_400Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_400Hz;
        freq1=400;
        trace1_Ei_name="Ei for "+FermiA_Name_400Hz;
        trace3_cal_x = FermiA_ResoCalc_400Hz_x;
        trace3_cal_y = FermiA_ResoCalc_400Hz_y;
        trace3_obs_x = FermiA_ResoObs_400Hz_x;
        trace3_obs_y = FermiA_ResoObs_400Hz_y;
        break;
      case 'FermiA_500Hz':
        trace1_cal_x = FermiA_IntCalc_500Hz_x;
        trace1_cal_y = FermiA_IntCalc_500Hz_y;
        trace1_obs_x = FermiA_IntObs_500Hz_x;
        trace1_obs_y = FermiA_IntObs_500Hz_y;
        trace1_color = FermiA_Color_500Hz;
        trace1_color2 = FermiA_Color2_500Hz;
        trace1_cal_name = FermiA_Name_500Hz+" (calc)";
        trace1_obs_name = FermiA_Name_500Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_500Hz;
        freq1=500;
        trace1_Ei_name="Ei for "+FermiA_Name_500Hz;
        trace3_cal_x = FermiA_ResoCalc_500Hz_x;
        trace3_cal_y = FermiA_ResoCalc_500Hz_y;
        trace3_obs_x = FermiA_ResoObs_500Hz_x;
        trace3_obs_y = FermiA_ResoObs_500Hz_y;
        break;
      case 'FermiA_600Hz':
        trace1_cal_x = FermiA_IntCalc_600Hz_x;
        trace1_cal_y = FermiA_IntCalc_600Hz_y;
        trace1_obs_x = FermiA_IntObs_600Hz_x;
        trace1_obs_y = FermiA_IntObs_600Hz_y;
        trace1_color = FermiA_Color_600Hz;
        trace1_color2 = FermiA_Color2_600Hz;
        trace1_cal_name = FermiA_Name_600Hz+" (calc)";
        trace1_obs_name = FermiA_Name_600Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_600Hz;
        freq1=600;
        trace1_Ei_name="Ei for "+FermiA_Name_600Hz;
        trace3_cal_x = FermiA_ResoCalc_600Hz_x;
        trace3_cal_y = FermiA_ResoCalc_600Hz_y;
        trace3_obs_x = FermiA_ResoObs_600Hz_x;
        trace3_obs_y = FermiA_ResoObs_600Hz_y;
        break;
      case 'FermiB_100Hz':
        trace1_cal_x = FermiB_IntCalc_100Hz_x;
        trace1_cal_y = FermiB_IntCalc_100Hz_y;
        trace1_obs_x = FermiB_IntObs_100Hz_x;
        trace1_obs_y = FermiB_IntObs_100Hz_y;
        trace1_color = FermiB_Color_100Hz;
        trace1_color2 = FermiB_Color2_100Hz;
        trace1_cal_name = FermiB_Name_100Hz+" (calc)";
        trace1_obs_name = FermiB_Name_100Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_100Hz;
        freq1=100;
        trace1_Ei_name="Ei for "+FermiB_Name_100Hz;
        trace3_cal_x = FermiB_ResoCalc_100Hz_x;
        trace3_cal_y = FermiB_ResoCalc_100Hz_y;
        trace3_obs_x = FermiB_ResoObs_100Hz_x;
        trace3_obs_y = FermiB_ResoObs_100Hz_y;
        break;
      case 'FermiB_200Hz':
        trace1_cal_x = FermiB_IntCalc_200Hz_x;
        trace1_cal_y = FermiB_IntCalc_200Hz_y;
        trace1_obs_x = FermiB_IntObs_200Hz_x;
        trace1_obs_y = FermiB_IntObs_200Hz_y;
        trace1_color = FermiB_Color_200Hz;
        trace1_color2 = FermiB_Color2_200Hz;
        trace1_cal_name = FermiB_Name_200Hz+" (calc)";
        trace1_obs_name = FermiB_Name_200Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_200Hz;
        freq1=200;
        trace1_Ei_name="Ei for "+FermiB_Name_200Hz;
        trace3_cal_x = FermiB_ResoCalc_200Hz_x;
        trace3_cal_y = FermiB_ResoCalc_200Hz_y;
        trace3_obs_x = FermiB_ResoObs_200Hz_x;
        trace3_obs_y = FermiB_ResoObs_200Hz_y;
        break;
      case 'FermiB_300Hz':
        trace1_cal_x = FermiB_IntCalc_300Hz_x;
        trace1_cal_y = FermiB_IntCalc_300Hz_y;
        trace1_obs_x = FermiB_IntObs_300Hz_x;
        trace1_obs_y = FermiB_IntObs_300Hz_y;
        trace1_color = FermiB_Color_300Hz;
        trace1_color2 = FermiB_Color2_300Hz;
        trace1_cal_name = FermiB_Name_300Hz+" (calc)";
        trace1_obs_name = FermiB_Name_300Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_300Hz;
        freq1=300;
        trace1_Ei_name="Ei for "+FermiB_Name_300Hz;
        trace3_cal_x = FermiB_ResoCalc_300Hz_x;
        trace3_cal_y = FermiB_ResoCalc_300Hz_y;
        trace3_obs_x = FermiB_ResoObs_300Hz_x;
        trace3_obs_y = FermiB_ResoObs_300Hz_y;
        break;
      case 'FermiB_400Hz':
        trace1_cal_x = FermiB_IntCalc_400Hz_x;
        trace1_cal_y = FermiB_IntCalc_400Hz_y;
        trace1_obs_x = FermiB_IntObs_400Hz_x;
        trace1_obs_y = FermiB_IntObs_400Hz_y;
        trace1_color = FermiB_Color_400Hz;
        trace1_color2 = FermiB_Color2_400Hz;
        trace1_cal_name = FermiB_Name_400Hz+" (calc)";
        trace1_obs_name = FermiB_Name_400Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_400Hz;
        freq1=400;
        trace1_Ei_name="Ei for "+FermiB_Name_400Hz;
        trace3_cal_x = FermiB_ResoCalc_400Hz_x;
        trace3_cal_y = FermiB_ResoCalc_400Hz_y;
        trace3_obs_x = FermiB_ResoObs_400Hz_x;
        trace3_obs_y = FermiB_ResoObs_400Hz_y;
        break;
      case 'FermiB_500Hz':
        trace1_cal_x = FermiB_IntCalc_500Hz_x;
        trace1_cal_y = FermiB_IntCalc_500Hz_y;
        trace1_obs_x = FermiB_IntObs_500Hz_x;
        trace1_obs_y = FermiB_IntObs_500Hz_y;
        trace1_color = FermiB_Color_500Hz;
        trace1_color2 = FermiB_Color2_500Hz;
        trace1_cal_name = FermiB_Name_500Hz+" (calc)";
        trace1_obs_name = FermiB_Name_500Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_500Hz;
        freq1=500;
        trace1_Ei_name="Ei for "+FermiB_Name_500Hz;
        trace3_cal_x = FermiB_ResoCalc_500Hz_x;
        trace3_cal_y = FermiB_ResoCalc_500Hz_y;
        trace3_obs_x = FermiB_ResoObs_500Hz_x;
        trace3_obs_y = FermiB_ResoObs_500Hz_y;
        break;
      case 'FermiB_600Hz':
        trace1_cal_x = FermiB_IntCalc_600Hz_x;
        trace1_cal_y = FermiB_IntCalc_600Hz_y;
        trace1_obs_x = FermiB_IntObs_600Hz_x;
        trace1_obs_y = FermiB_IntObs_600Hz_y;
        trace1_color = FermiB_Color_600Hz;
        trace1_color2 = FermiB_Color2_600Hz;
        trace1_cal_name = FermiB_Name_600Hz+" (calc)";
        trace1_obs_name = FermiB_Name_600Hz+" (obs)";
        trace1_Ymax = FermiB_IntMax_600Hz;
        freq1=600;
        trace1_Ei_name="Ei for "+FermiB_Name_600Hz;
        trace3_cal_x = FermiB_ResoCalc_600Hz_x;
        trace3_cal_y = FermiB_ResoCalc_600Hz_y;
        trace3_obs_x = FermiB_ResoObs_600Hz_x;
        trace3_obs_y = FermiB_ResoObs_600Hz_y;
        break;
      default:
        trace1_cal_x = FermiA_IntCalc_200Hz_x;
        trace1_cal_y = FermiA_IntCalc_200Hz_y;
        trace1_obs_x = FermiA_IntObs_200Hz_x;
        trace1_obs_y = FermiA_IntObs_200Hz_y;
        trace1_color = FermiA_Color_200Hz;
        trace1_color2 = FermiA_Color2_200Hz;
        trace1_cal_name = FermiA_Name_200Hz+" (calc)";
        trace1_obs_name = FermiA_Name_200Hz+" (obs)";
        trace1_Ymax = FermiA_IntMax_200Hz;
        trace1_Ei_name="Ei for "+FermiA_Name_200Hz;
        freq1=200;
        trace3_cal_x = FermiA_ResoCalc_200Hz_x;
        trace3_cal_y = FermiA_ResoCalc_200Hz_y;
        trace3_obs_x = FermiA_ResoObs_200Hz_x;
        trace3_obs_y = FermiA_ResoObs_200Hz_y;

    }


    switch(document.getElementById('ChopperSetiing2').value){
      case 'FermiA_100Hz':
        trace2_cal_x = FermiA_IntCalc_100Hz_x;
        trace2_cal_y = FermiA_IntCalc_100Hz_y;
        trace2_obs_x = FermiA_IntObs_100Hz_x;
        trace2_obs_y = FermiA_IntObs_100Hz_y;
        trace2_color = FermiA_Color_100Hz;
        trace2_color2 = FermiA_Color2_100Hz;
        trace2_cal_name = FermiA_Name_100Hz+" (calc)";
        trace2_obs_name = FermiA_Name_100Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_100Hz;
        freq2=100;
        trace2_Ei_name="Ei for "+FermiA_Name_100Hz;
        trace4_cal_x = FermiA_ResoCalc_100Hz_x;
        trace4_cal_y = FermiA_ResoCalc_100Hz_y;
        trace4_obs_x = FermiA_ResoObs_100Hz_x;
        trace4_obs_y = FermiA_ResoObs_100Hz_y;
        break;
      case 'FermiA_200Hz':
        trace2_cal_x = FermiA_IntCalc_200Hz_x;
        trace2_cal_y = FermiA_IntCalc_200Hz_y;
        trace2_obs_x = FermiA_IntObs_200Hz_x;
        trace2_obs_y = FermiA_IntObs_200Hz_y;
        trace2_color = FermiA_Color_200Hz;
        trace2_color2 = FermiA_Color2_200Hz;
        trace2_cal_name = FermiA_Name_200Hz+" (calc)";
        trace2_obs_name = FermiA_Name_200Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_200Hz;
        freq2=200;
        trace2_Ei_name="Ei for "+FermiA_Name_200Hz;
        trace4_cal_x = FermiA_ResoCalc_200Hz_x;
        trace4_cal_y = FermiA_ResoCalc_200Hz_y;
        trace4_obs_x = FermiA_ResoObs_200Hz_x;
        trace4_obs_y = FermiA_ResoObs_200Hz_y;
        break;
      case 'FermiA_300Hz':
        trace2_cal_x = FermiA_IntCalc_300Hz_x;
        trace2_cal_y = FermiA_IntCalc_300Hz_y;
        trace2_obs_x = FermiA_IntObs_300Hz_x;
        trace2_obs_y = FermiA_IntObs_300Hz_y;
        trace2_color = FermiA_Color_300Hz;
        trace2_color2 = FermiA_Color2_300Hz;
        trace2_cal_name = FermiA_Name_300Hz+" (calc)";
        trace2_obs_name = FermiA_Name_300Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_300Hz;
        freq2=300;
        trace2_Ei_name="Ei for "+FermiA_Name_300Hz;
        trace4_cal_x = FermiA_ResoCalc_300Hz_x;
        trace4_cal_y = FermiA_ResoCalc_300Hz_y;
        trace4_obs_x = FermiA_ResoObs_300Hz_x;
        trace4_obs_y = FermiA_ResoObs_300Hz_y;
        break;
      case 'FermiA_400Hz':
        trace2_cal_x = FermiA_IntCalc_400Hz_x;
        trace2_cal_y = FermiA_IntCalc_400Hz_y;
        trace2_obs_x = FermiA_IntObs_400Hz_x;
        trace2_obs_y = FermiA_IntObs_400Hz_y;
        trace2_color = FermiA_Color_400Hz;
        trace2_color2 = FermiA_Color2_400Hz;
        trace2_cal_name = FermiA_Name_400Hz+" (calc)";
        trace2_obs_name = FermiA_Name_400Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_400Hz;
        freq2=400;
        trace2_Ei_name="Ei for "+FermiA_Name_400Hz;
        trace4_cal_x = FermiA_ResoCalc_400Hz_x;
        trace4_cal_y = FermiA_ResoCalc_400Hz_y;
        trace4_obs_x = FermiA_ResoObs_400Hz_x;
        trace4_obs_y = FermiA_ResoObs_400Hz_y;
        break;
      case 'FermiA_500Hz':
        trace2_cal_x = FermiA_IntCalc_500Hz_x;
        trace2_cal_y = FermiA_IntCalc_500Hz_y;
        trace2_obs_x = FermiA_IntObs_500Hz_x;
        trace2_obs_y = FermiA_IntObs_500Hz_y;
        trace2_color = FermiA_Color_500Hz;
        trace2_color2 = FermiA_Color2_500Hz;
        trace2_cal_name = FermiA_Name_500Hz+" (calc)";
        trace2_obs_name = FermiA_Name_500Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_500Hz;
        freq2=500;
        trace2_Ei_name="Ei for "+FermiA_Name_500Hz;
        trace4_cal_x = FermiA_ResoCalc_500Hz_x;
        trace4_cal_y = FermiA_ResoCalc_500Hz_y;
        trace4_obs_x = FermiA_ResoObs_500Hz_x;
        trace4_obs_y = FermiA_ResoObs_500Hz_y;
        break;
      case 'FermiA_600Hz':
        trace2_cal_x = FermiA_IntCalc_600Hz_x;
        trace2_cal_y = FermiA_IntCalc_600Hz_y;
        trace2_obs_x = FermiA_IntObs_600Hz_x;
        trace2_obs_y = FermiA_IntObs_600Hz_y;
        trace2_color = FermiA_Color_600Hz;
        trace2_color2 = FermiA_Color2_600Hz;
        trace2_cal_name = FermiA_Name_600Hz+" (calc)";
        trace2_obs_name = FermiA_Name_600Hz+" (obs)";
        trace2_Ymax = FermiA_IntMax_600Hz;
        freq2=600;
        trace2_Ei_name="Ei for "+FermiA_Name_600Hz;
        trace4_cal_x = FermiA_ResoCalc_600Hz_x;
        trace4_cal_y = FermiA_ResoCalc_600Hz_y;
        trace4_obs_x = FermiA_ResoObs_600Hz_x;
        trace4_obs_y = FermiA_ResoObs_600Hz_y;
        break;
      case 'FermiB_100Hz':
        trace2_cal_x = FermiB_IntCalc_100Hz_x;
        trace2_cal_y = FermiB_IntCalc_100Hz_y;
        trace2_obs_x = FermiB_IntObs_100Hz_x;
        trace2_obs_y = FermiB_IntObs_100Hz_y;
        trace2_color = FermiB_Color_100Hz;
        trace2_color2 = FermiB_Color2_100Hz;
        trace2_cal_name = FermiB_Name_100Hz+" (calc)";
        trace2_obs_name = FermiB_Name_100Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_100Hz;
        freq2=100;
        trace2_Ei_name="Ei for "+FermiB_Name_100Hz;
        trace4_cal_x = FermiB_ResoCalc_100Hz_x;
        trace4_cal_y = FermiB_ResoCalc_100Hz_y;
        trace4_obs_x = FermiB_ResoObs_100Hz_x;
        trace4_obs_y = FermiB_ResoObs_100Hz_y;
        break;
      case 'FermiB_200Hz':
        trace2_cal_x = FermiB_IntCalc_200Hz_x;
        trace2_cal_y = FermiB_IntCalc_200Hz_y;
        trace2_obs_x = FermiB_IntObs_200Hz_x;
        trace2_obs_y = FermiB_IntObs_200Hz_y;
        trace2_color = FermiB_Color_200Hz;
        trace2_color2 = FermiB_Color2_200Hz;
        trace2_cal_name = FermiB_Name_200Hz+" (calc)";
        trace2_obs_name = FermiB_Name_200Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_200Hz;
        freq2=200;
        trace2_Ei_name="Ei for "+FermiB_Name_200Hz;
        trace4_cal_x = FermiB_ResoCalc_200Hz_x;
        trace4_cal_y = FermiB_ResoCalc_200Hz_y;
        trace4_obs_x = FermiB_ResoObs_200Hz_x;
        trace4_obs_y = FermiB_ResoObs_200Hz_y;
        break;
      case 'FermiB_300Hz':
        trace2_cal_x = FermiB_IntCalc_300Hz_x;
        trace2_cal_y = FermiB_IntCalc_300Hz_y;
        trace2_obs_x = FermiB_IntObs_300Hz_x;
        trace2_obs_y = FermiB_IntObs_300Hz_y;
        trace2_color = FermiB_Color_300Hz;
        trace2_color2 = FermiB_Color2_300Hz;
        trace2_cal_name = FermiB_Name_300Hz+" (calc)";
        trace2_obs_name = FermiB_Name_300Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_300Hz;
        freq2=300;
        trace2_Ei_name="Ei for "+FermiB_Name_300Hz;
        trace4_cal_x = FermiB_ResoCalc_300Hz_x;
        trace4_cal_y = FermiB_ResoCalc_300Hz_y;
        trace4_obs_x = FermiB_ResoObs_300Hz_x;
        trace4_obs_y = FermiB_ResoObs_300Hz_y;
        break;
      case 'FermiB_400Hz':
        trace2_cal_x = FermiB_IntCalc_400Hz_x;
        trace2_cal_y = FermiB_IntCalc_400Hz_y;
        trace2_obs_x = FermiB_IntObs_400Hz_x;
        trace2_obs_y = FermiB_IntObs_400Hz_y;
        trace2_color = FermiB_Color_400Hz;
        trace2_color2 = FermiB_Color2_400Hz;
        trace2_cal_name = FermiB_Name_400Hz+" (calc)";
        trace2_obs_name = FermiB_Name_400Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_400Hz;
        freq2=400;
        trace2_Ei_name="Ei for "+FermiB_Name_400Hz;
        trace4_cal_x = FermiB_ResoCalc_400Hz_x;
        trace4_cal_y = FermiB_ResoCalc_400Hz_y;
        trace4_obs_x = FermiB_ResoObs_400Hz_x;
        trace4_obs_y = FermiB_ResoObs_400Hz_y;
        break;
      case 'FermiB_500Hz':
        trace2_cal_x = FermiB_IntCalc_500Hz_x;
        trace2_cal_y = FermiB_IntCalc_500Hz_y;
        trace2_obs_x = FermiB_IntObs_500Hz_x;
        trace2_obs_y = FermiB_IntObs_500Hz_y;
        trace2_color = FermiB_Color_500Hz;
        trace2_color2 = FermiB_Color2_500Hz;
        trace2_cal_name = FermiB_Name_500Hz+" (calc)";
        trace2_obs_name = FermiB_Name_500Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_500Hz;
        freq2=500;
        trace2_Ei_name="Ei for "+FermiB_Name_500Hz;
        trace4_cal_x = FermiB_ResoCalc_500Hz_x;
        trace4_cal_y = FermiB_ResoCalc_500Hz_y;
        trace4_obs_x = FermiB_ResoObs_500Hz_x;
        trace4_obs_y = FermiB_ResoObs_500Hz_y;
        break;
      case 'FermiB_600Hz':
        trace2_cal_x = FermiB_IntCalc_600Hz_x;
        trace2_cal_y = FermiB_IntCalc_600Hz_y;
        trace2_obs_x = FermiB_IntObs_600Hz_x;
        trace2_obs_y = FermiB_IntObs_600Hz_y;
        trace2_color = FermiB_Color_600Hz;
        trace2_color2 = FermiB_Color2_600Hz;
        trace2_cal_name = FermiB_Name_600Hz+" (calc)";
        trace2_obs_name = FermiB_Name_600Hz+" (obs)";
        trace2_Ymax = FermiB_IntMax_600Hz;
        freq2=600;
        trace2_Ei_name="Ei for "+FermiB_Name_600Hz;
        trace4_cal_x = FermiB_ResoCalc_600Hz_x;
        trace4_cal_y = FermiB_ResoCalc_600Hz_y;
        trace4_obs_x = FermiB_ResoObs_600Hz_x;
        trace4_obs_y = FermiB_ResoObs_600Hz_y;
        break;
      default:
        trace2_cal_x = [];
        trace2_cal_y = [];
        trace2_obs_x = [];
        trace2_obs_y = [];
        trace2_color = "";
        trace2_color2 = "";
        trace2_cal_name = ""+" (calc)";
        trace2_obs_name = ""+" (obs)";
        trace2_Ymax = 0;
        freq2=200;

    }

    //trace1 and 2 for plotting calc/obs intensities as function of E
    trace1_cal = {
        x: trace1_cal_x,
        y: trace1_cal_y,
        mode:'lines',
        line:{
          color: trace1_color
        },
        name: trace1_cal_name,
    };

    trace1_obs = {
      x: trace1_obs_x,
      y: trace1_obs_y,
      mode:'markers',
      marker:{
        color: trace1_color,
        size: 8,
      },
      name: trace1_obs_name
    };


    trace2_cal = {
      x: trace2_cal_x,
      y: trace2_cal_y,
      mode:'lines',
      line:{
        color: trace2_color,
        dash:'dot'
      },
      name: trace2_cal_name,
    };

    trace2_obs = {
      x: trace2_obs_x,
      y: trace2_obs_y,
      mode:'markers',
      marker:{
        color: trace2_color,
        size: 8,
        symbol: 'circle-open'
      },
      name: trace2_obs_name
    };

  
    var Ymax;
    if(trace1_Ymax>trace2_Ymax){
      Ymax=trace1_Ymax;
    }
    else{
      Ymax=trace2_Ymax;
    }

    //trace3 and 4 for plotting calc/obs resolutions as function of E
    trace3_cal = {
      x: trace3_cal_x,
      y: trace3_cal_y,
      mode:'lines',
      line:{
        color: trace1_color
      },
      name: trace1_cal_name,
    };

    trace3_obs = {
      x: trace3_obs_x,
      y: trace3_obs_y,
      mode:'markers',
      marker:{
        color: trace1_color,
        size: 8,
      },
      name: trace1_obs_name
    };

    trace4_cal = {
      x: trace4_cal_x,
      y: trace4_cal_y,
      mode:'lines',
      line:{
        color: trace2_color,
        dash:'dot'
      },
      name: trace2_cal_name,
    };

    trace4_obs = {
      x: trace4_obs_x,
      y: trace4_obs_y,
      mode:'markers',
      marker:{
        color: trace2_color,
        size: 8,
        symbol: 'circle-open'
      },
      name: trace2_obs_name
    };

    // calculating Ei1 bars
    var ChopPeriod_R1 = 1.0/freq1*1000.0;       //Real chopper period (ms). Although a factor "1/2" is necessary for Fermi choppers with straight slits, the chopper of HRC has curved slits. So 1/2 is not necessary.
    var ChopRept1 = TOF_len_R/ChopPeriod_R1;

    for (var tt=0;tt<=ChopRept1;tt+=1){
        var t1=(tt)*ChopPeriod_R1;
        var t2=(tt+1.0)*ChopPeriod_R1;

        if ((TargetTOF_at_Chopper1 > t1) && (TargetTOF_at_Chopper1 <= t2) ){
            ChopOfst_R1=TargetTOF_at_Chopper1-t1;
        }
    }

    TOF_at_Chopper1[0]=(ChopOfst_R1);    

    for (var i = 1; i < ChopRept1; i += 1) {
        TOF_at_Chopper1[i]=(ChopPeriod_R1*(i)+ChopOfst_R1);    
    }
    
    var Ei_num_ofst1=0;   // Determine Ei num offset
    for (var i=0;i<ChopRept1;i+=1){
        var testE =(TOFconst/TOF_at_Chopper1[i]*(Lsc_R))**2.0;
        if (testE > upperLimitEi1){
            Ei_num_ofst1 += 1;
        }    
    }
    for(var i=0;i<Ei_numMax;i+=1){
      Ei1[i]=(TOFconst/TOF_at_Chopper1[Ei_num_ofst1+i]*(Lsc_R))**2.0;
      var idE='E'+(i+1)+'_1';
      document.getElementById(idE).innerHTML = Math.round(Ei1[i]*decimal_digit)/decimal_digit ;
    }

    // calculating Ei2 bars
    var ChopPeriod_R2 = 1.0/freq2*1000.0;       //Real chopper period (ms). Although a factor "1/2" is necessary for Fermi choppers with straight slits, the chopper of HRC has curved slits. So 1/2 is not necessary.
    var ChopRept2 = TOF_len_R/ChopPeriod_R2;

    for (var tt=0;tt<=ChopRept2;tt+=1){
        var t1=(tt)*ChopPeriod_R2;
        var t2=(tt+1.0)*ChopPeriod_R2;

        if ((TargetTOF_at_Chopper2 > t1) && (TargetTOF_at_Chopper2 <= t2) ){
            ChopOfst_R2=TargetTOF_at_Chopper2-t1;
        }
    }

    TOF_at_Chopper2[0]=(ChopOfst_R2);    

    for (var i = 1; i < ChopRept2; i += 1) {
        TOF_at_Chopper2[i]=(ChopPeriod_R2*(i)+ChopOfst_R2);    
    }

    var Ei_num_ofst2=0;      // Determine Ei num offset
    for (var i=0;i<ChopRept2;i+=1){
        var testE =(TOFconst/TOF_at_Chopper2[i]*(Lsc_R))**2.0 ;
        if (testE > upperLimitEi2){
            Ei_num_ofst2 += 1;
        }    
    }
    for(var i=0;i<Ei_numMax;i+=1){
      var idE='E'+(i+1)+'_2';
      Ei2[i]=(TOFconst/TOF_at_Chopper2[Ei_num_ofst2+i]*(Lsc_R))**2.0;
      document.getElementById(idE).innerHTML = Math.round(Ei2[i]*decimal_digit)/decimal_digit ;
    }

    //Select "absolute"/"Relative" resolution presentation
    var Ytitle_reso;
    if (document.getElementsByName("reso_select")[1].checked){
      Ytitle_reso="Energy resolution dE : FWHM (meV)";
      for (let ii=0;ii<trace3_cal_x.length;ii++){
        trace3_cal_y[ii]=trace3_cal_y[ii]*trace3_cal_x[ii];
      }
      for (let ii=0;ii<trace3_obs_x.length;ii++){
        trace3_obs_y[ii]=trace3_obs_y[ii]*trace3_obs_x[ii];
      }
      Ymax_Reso=trace3_obs_y[trace3_obs_x.length-1]*1.1;
      Ymax_Reso=40;

      if((document.getElementById('ChopperSetiing2').value!='none')){
        for (let ii=0;ii<trace4_cal_x.length;ii++){
          trace4_cal_y[ii]=trace4_cal_y[ii]*trace4_cal_x[ii];
        }
        for (let ii=0;ii<trace4_obs_x.length;ii++){
          trace4_obs_y[ii]=trace4_obs_y[ii]*trace4_obs_x[ii];
        }
        if(trace4_obs_y[trace4_obs_x.length-1]*1.1 > Ymax_Reso){
          Ymax_Reso=trace4_obs_y[trace4_obs_x.length-1]*1.1;
        }
  
      }
    }
    else{
      Ytitle_reso="Energy resolution dE/E ";
      Ymax_Reso=0.1;
    }
    
  
    // trace to show vertical bars for Ei1 and Ei2
    var trace_Ei1 = {
      x: Ei1,
      y: [Ymax,Ymax,Ymax,Ymax,Ymax],
      type: 'bar',
      width: 0,
      marker:{
        color:trace1_color2,
        line:{
          width:2,
          color:trace1_color2
        }
      },
      name: trace1_Ei_name,
      opacity:0.2
    };

    var trace_Ei1_Reso = {
      x: Ei1,
      y: [Ymax_Reso,Ymax_Reso,Ymax_Reso,Ymax_Reso,Ymax_Reso],
      type: 'bar',
      width: 0,
      marker:{
        color:trace1_color2,
        line:{
          width:2,
          color:trace1_color2
        }
      },
      name: trace1_Ei_name,
      opacity:0.2
    };

    var trace_Ei2 = {
      x: Ei2,
      y: [Ymax,Ymax,Ymax,Ymax,Ymax],
      type: 'bar',
      width: 0,
      marker:{
        color:trace2_color2,
        line:{
          width:2,
          color:trace2_color2
        }
      }, 
      name: trace2_Ei_name,
      opacity:0.2
    };

    var trace_Ei2_Reso = {
      x: Ei2,
      y: [Ymax_Reso,Ymax_Reso,Ymax_Reso,Ymax_Reso,Ymax_Reso],
      type: 'bar',
      width: 0,
      marker:{
        color:trace2_color2,
        line:{
          width:2,
          color:trace2_color2
        }
      }, 
      name: trace2_Ei_name,
      opacity:0.2
    };



    //layout for the intensity plot
    var layout = {
        xaxis: {
          type: 'log',
          showgrid:true,
          range:[0,3.6],
          title: 'Energy (meV)',
          titlefont:{
            family:'Arial',
            size:22
          },
          tickfont: {
            family:'Arial',
            size: 16,
          },
          linewidth:1,
          mirror:true
        },

        yaxis: {
          type: 'linear',
          range:[0,Ymax],
          title: 'Intensity (arb. units)',
          titlefont:{
            family:'Arial',
            size:22
          },
          tickfont: {
            family:'Arial',
            size: 16,
          },
          linewidth:1,
          mirror:true
        },
        
        margin:{
          t:50,
          b:50,
          l:100,
          r:10,
          autoexpand:true
        },
        barmode:'overlay'
    };

    //Layout for resolution plot
    var layout2 = {
      xaxis: {
        type: 'log',
        showgrid:true,
        range:[0,3.6],
        title: 'Energy (meV)',
        titlefont:{
          family:'Arial',
          size:22
        },
        tickfont: {
          family:'Arial',
          size: 16,
        },
        linewidth:1,
        mirror:true
      },

      yaxis: {
        type: 'linear',
        range:[0,Ymax_Reso],
        title: Ytitle_reso,
        titlefont:{
          family:'Arial',
          size:22
        },
        tickfont: {
          family:'Arial',
          size: 16,
        },
        linewidth:1,
        mirror:true
      },
      
      margin:{
        t:50,
        b:50,
        l:100,
        r:10,
        autoexpand:true
      },
      barmode:'overlay'
  };

    if(document.getElementById('ChopperSetiing2').value=='none'){
      var data=[trace1_cal,trace1_obs,trace_Ei1];
      Plotly.newPlot('IntPlot', data,layout, {displayModeBar: true});
      var data2=[trace3_cal,trace3_obs,trace_Ei1_Reso];
      Plotly.newPlot('ResolutionPlot', data2,layout2, {displayModeBar: true});
    }
    else if ((freq1==freq2) && (TargetEi1==TargetEi2)){
      var data=[trace1_cal,trace1_obs,trace2_cal,trace2_obs,trace_Ei1];
      Plotly.newPlot('IntPlot', data,layout, {displayModeBar: true});
      var data2=[trace3_cal,trace3_obs,trace4_cal,trace4_obs,trace_Ei1_Reso];
      Plotly.newPlot('ResolutionPlot', data2,layout2, {displayModeBar: true});
    }
    else{
      var data=[trace1_cal,trace1_obs,trace2_cal,trace2_obs,trace_Ei1,trace_Ei2];
      Plotly.newPlot('IntPlot', data,layout, {displayModeBar: true});
      var data2=[trace3_cal,trace3_obs,trace4_cal,trace4_obs,trace_Ei1_Reso,trace_Ei2_Reso];
      Plotly.newPlot('ResolutionPlot', data2,layout2, {displayModeBar: true});
    }

}
